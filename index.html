<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequence Playback Controls</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            padding: 20px;
            margin: 0;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .controls {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .playlist-item {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .playlist-item:hover {
            transform: translateY(-2px);
        }
        button {
            background-color: #3498db;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #2980b9;
        }
        input[type="range"], input[type="number"], select {
            width: 100%;
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        label {
            font-size: 16px;
            color: #2c3e50;
        }
        .loading {
            text-align: center;
            font-size: 18px;
            color: #3498db;
            margin-top: 20px;
        }
        .icon {
            margin-right: 10px;
            vertical-align: middle;
        }
        @media (max-width: 600px) {
            .controls {
                padding: 15px;
            }
            button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
    <script src="https://unpkg.com/audio-buffer-to-wav"></script>
</head>
<body>
    <h1>Sequence Playback Controls</h1>
    <div class="controls">
        <h2>Frequency A Settings</h2>
        <label for="freqA-type">Waveform:</label>
        <select id="freqA-type">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
        </select>
        <br>
        <label for="freqA-freq">Frequency (Hz):</label>
        <input type="number" id="freqA-freq" min="0.5" max="5000" step="0.1" value="440">
    </div>
    <div class="controls">
        <h2>Frequency B Settings</h2>
        <label for="freqB-type">Waveform:</label>
        <select id="freqB-type">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
        </select>
        <br>
        <label for="freqB-freq">Frequency (Hz):</label>
        <input type="number" id="freqB-freq" min="0.5" max="5000" step="0.1" value="440">
    </div>
    <div class="controls">
        <label for="duration">Duration (seconds):</label>
        <input type="number" id="duration" min="0.1" step="0.1" value="33">
        <br>
        <button id="add-to-playlist">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add to Playlist
        </button>
    </div>
    <div>
        <h2>Playlist</h2>
        <div id="playlist"></div>
    </div>
    <div>
        <button id="play">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Play
        </button>
        <button id="download">
            <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
        </button>
    </div>
    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let playlist = [];

        function addToPlaylist() {
            const typeA = document.getElementById('freqA-type').value;
            const freqA = parseFloat(document.getElementById('freqA-freq').value);
            const typeB = document.getElementById('freqB-type').value;
            const freqB = parseFloat(document.getElementById('freqB-freq').value);
            const duration = parseFloat(document.getElementById('duration').value);
            if (isNaN(freqA) || isNaN(freqB) || isNaN(duration) || freqA < 0.5 || freqA > 5000 || freqB < 0.5 || freqB > 5000 || duration <= 0) {
                alert('Invalid input, please check frequency and duration');
                return;
            }
            const item = { typeA, freqA, typeB, freqB, duration };
            playlist.push(item);
            const itemDiv = document.createElement('div');
            itemDiv.className = 'playlist-item';
            itemDiv.textContent = `Frequency A: ${typeA} ${freqA}Hz, Frequency B: ${typeB} ${freqB}Hz, Duration: ${duration}s`;
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.onclick = () => {
                const index = playlist.indexOf(item);
                if (index > -1) {
                    playlist.splice(index, 1);
                }
                itemDiv.remove();
            };
            itemDiv.appendChild(deleteBtn);
            document.getElementById('playlist').appendChild(itemDiv);
        }

        function playPlaylist() {
            if (playlist.length === 0) {
                alert('Playlist is empty');
                return;
            }
            let currentTime = audioContext.currentTime;
            playlist.forEach((item, index) => {
                const oscA = audioContext.createOscillator();
                oscA.type = item.typeA;
                oscA.frequency.setValueAtTime(item.freqA, currentTime);
                oscA.connect(audioContext.destination);
                oscA.start(currentTime);
                oscA.stop(currentTime + item.duration);

                const oscB = audioContext.createOscillator();
                oscB.type = item.typeB;
                oscB.frequency.setValueAtTime(item.freqB, currentTime);
                oscB.connect(audioContext.destination);
                oscB.start(currentTime);
                oscB.stop(currentTime + item.duration);

                currentTime += item.duration + 0.5; // 0.5s pause after each group
            });
        }

        function downloadPlaylist() {
            if (playlist.length === 0) {
                alert('Playlist is empty');
                return;
            }
            const pauseDuration = 0.5; // Pause between groups
            const totalDuration = playlist.reduce((sum, item) => sum + item.duration, 0) + (playlist.length - 1) * pauseDuration;
            const sampleRate = audioContext.sampleRate;
            const offlineContext = new OfflineAudioContext(2, totalDuration * sampleRate, sampleRate);
            let currentTime = 0;
            playlist.forEach((item, index) => {
                const oscA = offlineContext.createOscillator();
                oscA.type = item.typeA;
                oscA.frequency.setValueAtTime(item.freqA, currentTime);
                oscA.connect(offlineContext.destination);
                oscA.start(currentTime);
                oscA.stop(currentTime + item.duration);

                const oscB = offlineContext.createOscillator();
                oscB.type = item.typeB;
                oscB.frequency.setValueAtTime(item.freqB, currentTime);
                oscB.connect(offlineContext.destination);
                oscB.start(currentTime);
                oscB.stop(currentTime + item.duration);

                if (index < playlist.length - 1) {
                    currentTime += item.duration + pauseDuration;
                } else {
                    currentTime += item.duration;
                }
            });
            const loading = document.createElement('div');
            loading.className = 'loading';
            loading.textContent = 'Rendering audio...';
            document.body.appendChild(loading);
            offlineContext.startRendering().then(renderedBuffer => {
                const wav = audioBufferToWav(renderedBuffer);
                const blob = new Blob([wav], { type: 'audio/wav' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'playlist.wav';
                a.click();
                URL.revokeObjectURL(url);
                document.body.removeChild(loading);
            });
        }

        document.getElementById('add-to-playlist').addEventListener('click', addToPlaylist);
        document.getElementById('play').addEventListener('click', playPlaylist);
        document.getElementById('download').addEventListener('click', downloadPlaylist);
    </script>
</body>
</html>
